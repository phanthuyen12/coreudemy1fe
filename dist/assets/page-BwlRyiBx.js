import{ay as p,r as l,j as e,b,B as x,I as A,F as i,a as F,C as c}from"./index-BmJdQGgB.js";import{P}from"./PageBreadcrumb-CQuiEbQ2.js";import{P as M}from"./PageTitle-DvSd9fON.js";import{d as $}from"./documentCategoriesController-mu-rFsSN.js";import{S as h}from"./sweetalert2.all-BaGiBrXX.js";import{T as G}from"./Table-C8TA4xmc.js";import{B as K}from"./Badge-D3WP5yAB.js";import{M as j}from"./Modal-CQ1QepL_.js";import"./useWindow-BVDv9fYI.js";import"./AbstractModalHeader-DLCW9Nx1.js";import"./usePrevious-Bo4w_kS6.js";import"./hasClass-DoaUOyhL.js";import"./NoopTransition-BBjJjQrR.js";import"./DataKey-COGXBUcQ.js";class y{static async list(){const s=await fetch(`${p}/api/documents`);if(!s.ok)throw new Error("Failed to fetch documents");return s.json()}static async detail(s){const a=await fetch(`${p}/api/documents/${s}`);if(!a.ok)throw new Error("Failed to fetch document detail");return a.json()}static async create(s){const a=await fetch(`${p}/api/documents`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok)throw new Error("Failed to create document");return a.json()}static async update(s,a){const g=await fetch(`${p}/api/documents/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!g.ok)throw new Error("Failed to update document");return g.json()}static async remove(s){const a=await fetch(`${p}/api/documents/${s}`,{method:"DELETE"});if(!a.ok)throw new Error("Failed to delete document");return a.json()}}class U{async list(){return y.list()}async detail(s){return y.detail(s)}async create(s){return y.create(s)}async update(s,a){return y.update(s,a)}async remove(s){return y.remove(s)}}const te=()=>{const d=l.useMemo(()=>new U,[]),s=l.useMemo(()=>new $,[]),[a,g]=l.useState([]),[f,B]=l.useState([]),[L,C]=l.useState(!1),[S,u]=l.useState(!1),[v,k]=l.useState(null),[r,o]=l.useState({categoryId:"",title:"",description:"",link:"",type:"",uploadedBy:"",isActive:!0}),w=async()=>{try{C(!0);const[t,n]=await Promise.all([d.list(),s.list()]),m=Array.isArray(t)?t:(t==null?void 0:t.data)??(t==null?void 0:t.items)??[],D=Array.isArray(n)?n:(n==null?void 0:n.data)??(n==null?void 0:n.items)??[];g(m),B(D)}catch{h.fire({icon:"error",title:"Lỗi",text:"Không thể tải dữ liệu"})}finally{C(!1)}};l.useEffect(()=>{w()},[]);const I=()=>{k(null),o({categoryId:"",title:"",description:"",link:"",type:"",uploadedBy:"",isActive:!0}),u(!0)},N=t=>{k(t.id),o({categoryId:t.categoryId||"",title:t.title||"",description:t.description||"",link:t.link||"",type:t.type||"",uploadedBy:t.uploadedBy||"",isActive:!!t.isActive}),u(!0)},T=async t=>{if(t.preventDefault(),!r.title||!r.link||!r.type)return;const n={categoryId:r.categoryId===""?void 0:Number(r.categoryId),title:r.title,description:r.description||void 0,link:r.link,type:r.type,uploadedBy:r.uploadedBy===""?void 0:Number(r.uploadedBy),isActive:!!r.isActive};try{v?await d.update(v,n):await d.create(n),await w(),h.fire({icon:"success",title:"Thành công",timer:1200,showConfirmButton:!1}),u(!1)}catch{h.fire({icon:"error",title:"Lỗi",text:"Không thể lưu"})}},E=async t=>{if((await h.fire({icon:"warning",title:"Xóa tài liệu?",showCancelButton:!0})).isConfirmed)try{await d.remove(t),await w(),h.fire({icon:"success",title:"Đã xóa",timer:1e3,showConfirmButton:!1})}catch{h.fire({icon:"error",title:"Lỗi",text:"Không thể xóa"})}};return e.jsxs(e.Fragment,{children:[e.jsx(P,{subName:"Pages",title:"Tài liệu"}),e.jsx(M,{title:"Tài liệu"}),e.jsx(b,{className:"mb-3",children:e.jsxs(b.Body,{children:[e.jsxs("div",{className:"d-flex flex-wrap justify-content-between align-items-center gap-2",children:[e.jsx("h4",{className:"card-title mb-0",children:"DANH SÁCH TÀI LIỆU"}),e.jsx(x,{size:"sm",variant:"primary",onClick:I,children:"Thêm tài liệu"})]}),e.jsx("div",{className:"table-responsive mt-3",children:e.jsxs(G,{hover:!0,className:"table-striped align-middle",children:[e.jsx("thead",{className:"table-primary text-center",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Tiêu đề"}),e.jsx("th",{children:"Danh mục"}),e.jsx("th",{children:"Loại"}),e.jsx("th",{children:"Link"}),e.jsx("th",{children:"Trạng thái"}),e.jsx("th",{children:"Ngày tạo"}),e.jsx("th",{children:"Thao tác"})]})}),e.jsx("tbody",{children:L?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center p-5",children:"Đang tải dữ liệu..."})}):!Array.isArray(a)||a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center p-5",children:"Không có tài liệu."})}):a.map(t=>{const n=(Array.isArray(f)?f:[]).find(m=>m.id===t.categoryId);return e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted",children:e.jsx("strong",{children:t.title})}),e.jsx("td",{children:n?n.name:"—"}),e.jsx("td",{children:e.jsx(K,{bg:"secondary",children:t.type})}),e.jsx("td",{children:e.jsx("a",{href:t.link,target:"_blank",rel:"noreferrer",children:"Mở"})}),e.jsx("td",{children:t.isActive?"Active":"Inactive"}),e.jsx("td",{className:"text-center",children:t.createdAt?new Date(t.createdAt).toLocaleDateString():"—"}),e.jsxs("td",{className:"text-center d-flex justify-content-center gap-2",children:[e.jsx(x,{size:"sm",variant:"primary",title:"Sửa",onClick:()=>N(t),children:e.jsx(A,{icon:"mdi:pencil-outline"})}),e.jsx(x,{size:"sm",variant:"danger",title:"Xóa",onClick:()=>E(t.id),children:e.jsx(A,{icon:"mdi:trash-can-outline"})})]})]},t.id)})})]})})]})}),e.jsxs(j,{show:S,onHide:()=>u(!1),centered:!0,children:[e.jsx(j.Header,{closeButton:!0,children:e.jsx(j.Title,{children:v?"Chỉnh sửa tài liệu":"Thêm tài liệu"})}),e.jsxs(i,{onSubmit:T,children:[e.jsx(j.Body,{children:e.jsxs(F,{className:"g-3",children:[e.jsx(c,{md:6,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Danh mục"}),e.jsxs(i.Select,{value:r.categoryId,onChange:t=>o({...r,categoryId:t.target.value}),children:[e.jsx("option",{value:"",children:"— Không chọn —"}),(f||[]).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})}),e.jsx(c,{md:6,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Loại"}),e.jsx(i.Control,{value:r.type,required:!0,onChange:t=>o({...r,type:t.target.value}),placeholder:"pdf, sheet, doc, slide"})]})}),e.jsx(c,{md:12,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Tiêu đề"}),e.jsx(i.Control,{value:r.title,required:!0,onChange:t=>o({...r,title:t.target.value})})]})}),e.jsx(c,{md:12,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Link"}),e.jsx(i.Control,{type:"url",value:r.link,required:!0,onChange:t=>o({...r,link:t.target.value}),placeholder:"https://..."})]})}),e.jsx(c,{md:12,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Mô tả"}),e.jsx(i.Control,{as:"textarea",rows:3,value:r.description,onChange:t=>o({...r,description:t.target.value})})]})}),e.jsx(c,{md:6,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Uploaded By (User ID)"}),e.jsx(i.Control,{value:r.uploadedBy,onChange:t=>o({...r,uploadedBy:t.target.value})})]})}),e.jsx(c,{md:6,children:e.jsx(i.Group,{className:"d-flex align-items-center gap-2",style:{marginTop:30},children:e.jsx(i.Check,{type:"checkbox",checked:!!r.isActive,onChange:t=>o({...r,isActive:t.target.checked}),label:"Active"})})})]})}),e.jsxs(j.Footer,{children:[e.jsx(x,{variant:"light",onClick:()=>u(!1),children:"Đóng"}),e.jsx(x,{type:"submit",variant:"primary",children:"Lưu"})]})]})]})]})};export{te as default};
