import{ay as E,r as i,j as e,b as U,B as m,F as s,a as B,C as d,ax as W,az as Y}from"./index-BmJdQGgB.js";import{P as Z}from"./PageBreadcrumb-CQuiEbQ2.js";import{P as ee}from"./PageTitle-DvSd9fON.js";import{S as u}from"./sweetalert2.all-BaGiBrXX.js";import{T as te}from"./Table-C8TA4xmc.js";import{B as se}from"./Badge-D3WP5yAB.js";import{P as p}from"./Pagination-BmJ9MUyf.js";import{M as C}from"./Modal-CQ1QepL_.js";import"./Anchor-BiqR9obF.js";import"./useWindow-BVDv9fYI.js";import"./AbstractModalHeader-DLCW9Nx1.js";import"./usePrevious-Bo4w_kS6.js";import"./hasClass-DoaUOyhL.js";import"./NoopTransition-BBjJjQrR.js";import"./DataKey-COGXBUcQ.js";const w={async getEnrollments(n={}){const r=new URLSearchParams;return n.userId&&r.append("user_id",n.userId),n.courseId&&r.append("course_id",n.courseId),n.status&&r.append("status",n.status),n.page&&r.append("page",n.page),n.limit&&r.append("limit",n.limit),await(await fetch(`${E}/enrollments?${r.toString()}`)).json()},async createEnrollment(n){return await(await fetch(`${E}/enrollments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).json()},async updateEnrollment(n,r){return await(await fetch(`${E}/enrollments/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).json()},async deleteEnrollment(n){return await(await fetch(`${E}/enrollments/${n}`,{method:"DELETE"})).json()}};class ne{constructor(){this.enrollments=[],this.loading=!1,this.error=null}async getEnrollments(r){this.loading=!0,this.error=null;try{const a=await w.getEnrollments(r);return this.enrollments=a.data,a}catch(a){throw this.error=a.message,a}finally{this.loading=!1}}async createEnrollment(r){this.loading=!0,this.error=null;try{return await w.createEnrollment(r)}catch(a){throw this.error=a.message,a}finally{this.loading=!1}}async updateEnrollment(r,a){this.loading=!0,this.error=null;try{return await w.updateEnrollment(r,a)}catch(x){throw this.error=x.message,x}finally{this.loading=!1}}async deleteEnrollment(r){this.loading=!0,this.error=null;try{return await w.deleteEnrollment(r)}catch(a){throw this.error=a.message,a}finally{this.loading=!1}}}const b=new ne,re=new W,ae=new Y,M={userId:"",courseId:"",status:"",start_at:"",end_at:"",payment_status:"",voucher_code:"",note:""},ve=()=>{const[n,r]=i.useState([]),[a,x]=i.useState(!1),[S,y]=i.useState(!1),[c,_]=i.useState({...M}),[o,I]=i.useState({page:1,limit:10,userId:"",courseId:"",status:""}),[G,R]=i.useState(0),[$,X]=i.useState([]),[q,O]=i.useState([]),[L,N]=i.useState(!1),[P,T]=i.useState(null),v=async()=>{x(!0);try{const t=await b.getEnrollments(o);r(t.data.data||[]),R(t.data.total||0)}catch{u.fire("Lỗi","Không thể tải enrollments","error")}finally{x(!1)}},z=async()=>{try{const t=await re.getMemeber({page:1,limit:999});X(t.data.data||[]);const l=await ae.getCourses({page:1,limit:999});O(l.data.data||[])}catch{}};i.useEffect(()=>{v()},[o]),i.useEffect(()=>{S&&z()},[S]);const h=t=>{_({...c,[t.target.name]:t.target.value})},A=t=>{I({...o,[t.target.name]:t.target.value,page:1})},K=()=>I({page:1,limit:10,userId:"",courseId:"",status:""}),g=t=>I({...o,page:t}),f=Math.max(Math.ceil(G/o.limit),1),H=()=>{y(!0),_({...M}),N(!1),T(null)},J=t=>{var l,j;y(!0),_({userId:((l=t.user)==null?void 0:l.id)||"",courseId:((j=t.course)==null?void 0:j.id)||"",status:t.status||"",start_at:t.start_at?t.start_at.substring(0,16):"",end_at:t.end_at?t.end_at.substring(0,16):"",payment_status:t.payment_status||"",voucher_code:t.voucher_code||"",note:t.note||""}),N(!0),T(t.id)},D=()=>y(!1),V=async t=>{t.preventDefault();try{let l;L&&P?(l=await b.updateEnrollment(P,c),l.statusCode===200?u.fire("Thành công!","Cập nhật enrollment thành công","success"):u.fire("Lỗi!","Cập nhật enrollment thất bại","error")):(l=await b.createEnrollment(c),l.statusCode===200?u.fire("Thành công!","Tạo enrollment thành công","success"):u.fire("Lỗi!","Tạo enrollment thất bại","error")),y(!1),v()}catch{u.fire("Lỗi!","Xử lý enrollment thất bại","error")}},Q=async t=>{if((await u.fire({title:"Xác nhận",text:"Xoá enrollment này?",icon:"warning",showCancelButton:!0})).isConfirmed)try{await b.deleteEnrollment(t),v()}catch{u.fire("Lỗi","Không thể xoá enrollment","error")}};return e.jsxs(e.Fragment,{children:[e.jsx(Z,{subName:"Pages",title:"Enrollments"}),e.jsx(ee,{title:"Enrollments"}),e.jsx(U,{children:e.jsxs(U.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h4",{className:"mb-0",children:"QUẢN LÝ ENROLLMENTS"}),e.jsx(m,{variant:"primary",onClick:H,children:"Tạo Enrollment"})]}),e.jsx(s,{className:"mb-3 p-3 bg-light border rounded",children:e.jsxs(B,{className:"g-3 align-items-end",children:[e.jsxs(d,{md:3,children:[e.jsx(s.Label,{children:"User ID"}),e.jsx(s.Control,{name:"userId",value:o.userId,onChange:A})]}),e.jsxs(d,{md:3,children:[e.jsx(s.Label,{children:"Course ID"}),e.jsx(s.Control,{name:"courseId",value:o.courseId,onChange:A})]}),e.jsxs(d,{md:3,className:"d-flex gap-2",children:[e.jsx(m,{onClick:v,variant:"info",children:"Tìm kiếm"}),e.jsx(m,{variant:"danger",onClick:K,children:"Xoá lọc"})]})]})}),e.jsx("div",{className:"table-responsive",children:e.jsxs(te,{children:[e.jsx("thead",{className:"table-primary",children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"User "}),e.jsx("th",{children:"Course ID"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Start At"}),e.jsx("th",{children:"End At"}),e.jsx("th",{children:"Payment"}),e.jsx("th",{children:"Voucher"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Updated"}),e.jsx("th",{children:"Note"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:a?e.jsx("tr",{children:e.jsx("td",{colSpan:12,className:"text-center p-5",children:"Đang tải..."})}):n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:12,className:"text-center p-5",children:"Không có dữ liệu."})}):n.map(t=>{var l,j,k,F;return e.jsxs("tr",{children:[e.jsx("td",{children:t.id}),e.jsx("td",{children:((l=t.user)==null?void 0:l.username)||((j=t.user)==null?void 0:j.email)||t.userId||"—"}),e.jsx("td",{children:((k=t.course)==null?void 0:k.title)||((F=t.course)==null?void 0:F.code)||t.courseId||"—"}),e.jsx("td",{children:e.jsx(se,{bg:"info",children:t.status})}),e.jsx("td",{children:t.start_at?new Date(t.start_at).toLocaleString():""}),e.jsx("td",{children:t.end_at?new Date(t.end_at).toLocaleString():""}),e.jsx("td",{children:t.payment_status}),e.jsx("td",{children:t.voucher_code}),e.jsx("td",{children:t.createdAt?new Date(t.createdAt).toLocaleString():""}),e.jsx("td",{children:t.updatedAt?new Date(t.updatedAt).toLocaleString():""}),e.jsx("td",{children:t.note}),e.jsxs("td",{children:[e.jsx(m,{size:"sm",variant:"warning",className:"me-2",onClick:()=>J(t),children:"Sửa"}),e.jsx(m,{size:"sm",variant:"danger",onClick:()=>Q(t.id),children:"Xoá"})]})]},t.id)})})]})}),f>1&&e.jsxs(p,{className:"justify-content-end mt-3 mb-0",children:[e.jsx(p.First,{disabled:o.page===1,onClick:()=>g(1)}),e.jsx(p.Prev,{disabled:o.page===1,onClick:()=>g(o.page-1)}),Array.from({length:f}).map((t,l)=>e.jsx(p.Item,{active:o.page===l+1,onClick:()=>g(l+1),children:l+1},l+1)),e.jsx(p.Next,{disabled:o.page===f,onClick:()=>g(o.page+1)}),e.jsx(p.Last,{disabled:o.page===f,onClick:()=>g(f)})]})]})}),e.jsxs(C,{show:S,onHide:D,centered:!0,children:[e.jsx(C.Header,{closeButton:!0,children:e.jsx(C.Title,{children:L?"Cập nhật Enrollment":"Tạo Enrollment mới"})}),e.jsxs(s,{onSubmit:V,children:[e.jsx(C.Body,{children:e.jsxs(B,{className:"g-3",children:[e.jsx(d,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"User"}),e.jsxs(s.Select,{name:"userId",value:c.userId,onChange:h,required:!0,children:[e.jsx("option",{value:"",children:"-- Chọn User --"}),$.map(t=>e.jsx("option",{value:t.id,children:t.username||t.email||t.id},t.id))]})]})}),e.jsx(d,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Course"}),e.jsxs(s.Select,{name:"courseId",value:c.courseId,onChange:h,required:!0,children:[e.jsx("option",{value:"",children:"-- Chọn Course --"}),q.map(t=>e.jsx("option",{value:t.id,children:t.title||t.code||t.id},t.id))]})]})}),e.jsx(d,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Status"}),e.jsxs(s.Select,{name:"status",value:c.status,onChange:h,required:!0,children:[e.jsx("option",{value:"",children:"-- Status --"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})}),e.jsx(d,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Start At"}),e.jsx(s.Control,{type:"datetime-local",name:"start_at",value:c.start_at,onChange:h})]})}),e.jsx(d,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"End At"}),e.jsx(s.Control,{type:"datetime-local",name:"end_at",value:c.end_at,onChange:h})]})}),e.jsx(d,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Payment Status"}),e.jsxs(s.Select,{name:"payment_status",value:c.payment_status,onChange:h,required:!0,children:[e.jsx("option",{value:"",children:"-- Payment --"}),e.jsx("option",{value:"ngan_hang",children:"Ngân hàng"}),e.jsx("option",{value:"tien_mat",children:"Tiền mặt"}),e.jsx("option",{value:"free",children:"Free"})]})]})}),e.jsx(d,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Voucher"}),e.jsx(s.Control,{name:"voucher_code",value:c.voucher_code,onChange:h})]})}),e.jsx(d,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Note"}),e.jsx(s.Control,{name:"note",value:c.note,onChange:h})]})})]})}),e.jsxs(C.Footer,{children:[e.jsx(m,{variant:"light",onClick:D,children:"Đóng"}),e.jsx(m,{type:"submit",variant:"primary",children:L?"Cập nhật":"Lưu"})]})]})]})]})};export{ve as default};
