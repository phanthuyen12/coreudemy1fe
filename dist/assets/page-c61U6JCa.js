import{r as o,n as _,j as e,o as ee,b as U,B as m,I as $,F as s,a as O,C as d,az as te}from"./index-BmJdQGgB.js";import{P as se}from"./PageBreadcrumb-CQuiEbQ2.js";import{P as ae}from"./PageTitle-DvSd9fON.js";import{v as re}from"./videosProductController-D90K6V0-.js";import{S}from"./sweetalert2.all-BaGiBrXX.js";import{v as ie}from"./videoCategoriesController-DQmkDw9N.js";import{T as ne}from"./Table-C8TA4xmc.js";import{B as V}from"./Badge-D3WP5yAB.js";import{P as j}from"./Pagination-BmJ9MUyf.js";import{M as w}from"./Modal-CQ1QepL_.js";import"./Anchor-BiqR9obF.js";import"./useWindow-BVDv9fYI.js";import"./AbstractModalHeader-DLCW9Nx1.js";import"./usePrevious-Bo4w_kS6.js";import"./hasClass-DoaUOyhL.js";import"./NoopTransition-BBjJjQrR.js";import"./DataKey-COGXBUcQ.js";const q=o.forwardRef(({bsPrefix:u,variant:I,animation:M="border",size:N,as:T="div",className:h,...g},L)=>{u=_(u,"spinner");const p=`${u}-${M}`;return e.jsx(T,{ref:L,...g,className:ee(h,p,N&&`${p}-${N}`,I&&`text-${I}`)})});q.displayName="Spinner";const B=new ie,le=new te,E=new re,Ne=()=>{const[u,I]=o.useState([]),[M,N]=o.useState([]),[T,h]=o.useState([]),[g,L]=o.useState([]),[p,A]=o.useState(!0),[G,z]=o.useState(0),[n,P]=o.useState({page:1,limit:10,title:"",status:"",courseId:""}),[W,f]=o.useState(!1),[F,H]=o.useState(null),[a,C]=o.useState({courseId:"",categoryId:"",title:"",file:null,url:"",duration:"",order:1,description:"",access:"Free"}),k=async()=>{A(!0);try{const t=await E.getVideoProducts(n);L(t.data.data||[]),z(t.data.total||0)}catch(t){S.fire({icon:"error",title:"Lỗi",text:t.message||"Không thể tải danh sách video!"})}finally{A(!1)}},X=async()=>{var l;const t=await le.getCourses({page:1,limit:1e3,active:1}),r=((l=t==null?void 0:t.data)==null?void 0:l.data)||[];if(I(r),r.length>0){let c=[];const i=r.map(y=>B.getDetailCategory(y.id));(await Promise.all(i)).forEach(y=>{var R;const K=(R=y==null?void 0:y.data)==null?void 0:R.data;Array.isArray(K)&&c.push(...K)}),N(c)}};o.useEffect(()=>{X()},[]),o.useEffect(()=>{k()},[n]);const x=t=>C({...a,[t.target.name]:t.target.value}),D=t=>P({...n,[t.target.name]:t.target.value,page:1}),J=()=>P({page:1,limit:10,title:"",status:"",courseId:""}),v=t=>P({...n,page:t}),Q=()=>{H(null),C({courseId:"",categoryId:"",title:"",file:null,url:"",duration:"",order:1,description:"",access:"Free"}),h([]),f(!0)},Y=async t=>{var r;if(H(t.id),C({...t,file:null,url:t.url||""}),t.courseId)try{const l=await B.getDetailCategory(t.courseId);h(((r=l==null?void 0:l.data)==null?void 0:r.data)||[])}catch(l){console.error("Failed to fetch categories for editing:",l),h([])}f(!0)},Z=async t=>{var l,c;if(t.preventDefault(),!a.title||!a.courseId||!a.categoryId){S.fire({icon:"warning",title:"Thiếu thông tin",text:"Vui lòng điền đầy đủ các trường bắt buộc!"});return}const r=new FormData;Object.keys(a).forEach(i=>{i==="file"&&a.file?r.append("video",a.file):a[i]!==null&&i!=="url"&&r.append(i,a[i])}),r.has("status")||r.append("status","1");try{let i;F?i=await E.updateVideoProduct(F,r):i=await E.createVideoProduct(r),i&&i.data&&(i.statusCode===200||i.statusCode===201)?(S.fire({icon:"success",title:"Thành công!",timer:1500,showConfirmButton:!1}),f(!1),k()):S.fire({icon:"error",title:"Có lỗi xảy ra",text:(i==null?void 0:i.message)||"Unknown error"})}catch(i){S.fire({icon:"error",title:"Thao tác thất bại",text:((c=(l=i==null?void 0:i.response)==null?void 0:l.data)==null?void 0:c.message)||"Lỗi máy chủ"})}},b=Math.max(1,Math.ceil(G/n.limit));return e.jsxs(e.Fragment,{children:[e.jsx(se,{subName:"Pages",title:"Videos Khóa Học"}),e.jsx(ae,{title:"Videos Khóa Học"}),e.jsxs("div",{className:"container-fluid",children:[e.jsx(U,{children:e.jsxs(U.Body,{children:[e.jsxs("div",{className:"d-flex flex-wrap justify-content-between align-items-center gap-2",children:[e.jsx("h4",{className:"card-title mb-0",children:"DANH SÁCH VIDEOS"}),e.jsxs(m,{size:"sm",variant:"primary",onClick:Q,children:[e.jsx($,{icon:"mdi:video-plus-outline",className:"me-1"})," Thêm video"]})]}),e.jsx(s,{className:"mt-3 p-3 bg-light border rounded",onSubmit:t=>{t.preventDefault(),k()},children:e.jsxs(O,{className:"g-3 align-items-end",children:[e.jsxs(d,{lg:3,md:6,children:[e.jsx(s.Label,{children:"Tìm kiếm"}),e.jsx(s.Control,{name:"title",value:n.title,onChange:D,placeholder:"Tiêu đề video"})]}),e.jsxs(d,{lg:3,md:6,children:[e.jsx(s.Label,{children:"Khóa học"}),e.jsxs(s.Select,{name:"courseId",value:n.courseId,onChange:D,children:[e.jsx("option",{value:"",children:"Tất cả khóa học"}),u.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),e.jsxs(d,{lg:2,md:6,children:[e.jsx(s.Label,{children:"Trạng thái"}),e.jsxs(s.Select,{name:"status",value:n.status,onChange:D,children:[e.jsx("option",{value:"",children:"Tất cả"}),e.jsx("option",{value:"1",children:"Active"}),e.jsx("option",{value:"0",children:"Inactive"})]})]}),e.jsxs(d,{lg:4,md:6,className:"d-flex gap-2",children:[e.jsx(m,{variant:"info",type:"submit",className:"w-100",children:"Tìm kiếm"}),e.jsx(m,{variant:"danger",className:"w-100",onClick:J,children:"Xóa lọc"})]})]})}),e.jsx("div",{className:"table-responsive mt-3",children:e.jsxs(ne,{className:" align-middle text-center",children:[e.jsx("thead",{className:"table-primary",children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Khóa học"}),e.jsx("th",{children:"Danh mục"}),e.jsx("th",{children:"Tiêu đề"}),e.jsx("th",{children:"Thời lượng"}),e.jsx("th",{children:"Số thứ tự"}),e.jsx("th",{children:"Truy cập"}),e.jsx("th",{children:"Trạng thái"}),e.jsx("th",{children:"Thao tác"})]})}),e.jsx("tbody",{children:p?e.jsx("tr",{children:e.jsxs("td",{colSpan:9,className:"text-center p-5",children:[e.jsx(q,{animation:"border"})," Đang tải..."]})}):g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"p-5 text-center",children:"Không có dữ liệu."})}):g.map((t,r)=>{var l,c;return e.jsxs("tr",{children:[e.jsx("td",{children:(n.page-1)*n.limit+r+1}),e.jsx("td",{children:((l=t.course)==null?void 0:l.title)||"—"}),e.jsx("td",{children:((c=t.category)==null?void 0:c.title)||"—"}),e.jsx("td",{className:"text-start",children:e.jsx("strong",{children:t.title})}),e.jsx("td",{children:t.duration||"—"}),e.jsx("td",{children:e.jsx(V,{bg:"secondary",children:t.order})}),e.jsx("td",{children:e.jsx(V,{bg:t.access==="Free"?"success":"warning",children:t.access})}),e.jsx("td",{children:e.jsx(V,{bg:t.status?"success":"secondary",children:t.status?"Active":"Inactive"})}),e.jsx("td",{className:"d-flex justify-content-center gap-2",children:e.jsx(m,{size:"sm",variant:"light",title:"Sửa",onClick:()=>Y(t),children:e.jsx($,{icon:"mdi:pencil-outline",className:"text-primary"})})})]},t.id)})})]})}),b>1&&!p&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("span",{children:["Hiển thị ",g.length," trên ",G]}),e.jsxs(j,{className:"justify-content-end mt-3 mb-0",children:[e.jsx(j.First,{disabled:n.page===1,onClick:()=>v(1)}),e.jsx(j.Prev,{disabled:n.page===1,onClick:()=>v(n.page-1)}),[...Array(b).keys()].map(t=>e.jsx(j.Item,{active:n.page===t+1,onClick:()=>v(t+1),children:t+1},t+1)),e.jsx(j.Next,{disabled:n.page===b,onClick:()=>v(n.page+1)}),e.jsx(j.Last,{disabled:n.page===b,onClick:()=>v(b)})]})]})]})}),e.jsxs(w,{show:W,onHide:()=>f(!1),centered:!0,children:[e.jsx(w.Header,{closeButton:!0,children:e.jsx(w.Title,{children:F?"Chỉnh sửa video":"Thêm video"})}),e.jsxs(s,{onSubmit:Z,children:[e.jsx(w.Body,{children:e.jsxs(O,{className:"g-3",children:[e.jsx(d,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Khóa học (*)"}),e.jsxs(s.Select,{name:"courseId",value:a.courseId,onChange:async t=>{var l;const r=t.target.value;if(C({...a,courseId:r,categoryId:""}),r)try{const c=await B.getDetailCategory(r);h(((l=c==null?void 0:c.data)==null?void 0:l.data)||[])}catch(c){console.error("Failed to fetch categories:",c),h([])}else h([])},required:!0,children:[e.jsx("option",{value:"",children:"Chọn khóa học"}),u.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]})}),e.jsx(d,{md:6,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Danh mục (*)"}),e.jsxs(s.Select,{name:"categoryId",value:a.categoryId,onChange:x,required:!0,disabled:!a.courseId||T.length===0,children:[e.jsx("option",{value:"",children:"Chọn danh mục"}),T.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]})}),e.jsx(d,{md:12,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Tiêu đề (*)"}),e.jsx(s.Control,{name:"title",value:a.title,onChange:x,required:!0})]})}),e.jsx(d,{md:12,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Upload video"}),e.jsx(s.Control,{type:"file",accept:"video/*",onChange:t=>{const r=t.target.files[0];r&&(a.url.startsWith("blob:")&&URL.revokeObjectURL(a.url),C({...a,file:r,url:URL.createObjectURL(r)}))}}),a.url&&e.jsx("video",{src:a.url,controls:!0,width:"100%",className:"mt-2 rounded"},a.url)]})}),e.jsx(d,{md:4,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Thời lượng"}),e.jsx(s.Control,{name:"duration",value:a.duration,onChange:x,placeholder:"e.g., 12:34"})]})}),e.jsx(d,{md:4,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Số thứ tự"}),e.jsx(s.Control,{name:"order",type:"number",min:1,value:a.order,onChange:x})]})}),e.jsx(d,{md:4,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Truy cập"}),e.jsxs(s.Select,{name:"access",value:a.access,onChange:x,children:[e.jsx("option",{value:"Free",children:"Free"}),e.jsx("option",{value:"Premium",children:"Premium"})]})]})}),e.jsx(d,{md:12,children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Mô tả"}),e.jsx(s.Control,{as:"textarea",rows:3,name:"description",value:a.description,onChange:x})]})})]})}),e.jsxs(w.Footer,{children:[e.jsx(m,{variant:"light",onClick:()=>f(!1),children:"Đóng"}),e.jsx(m,{type:"submit",variant:"primary",children:"Lưu"})]})]})]})]})]})};export{Ne as default};
