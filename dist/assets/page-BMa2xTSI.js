import{r,j as e,b as C,B as l,I as p,F as a,a as P,C as N}from"./index-UeTnRMFd.js";import{P as H}from"./PageBreadcrumb-Dw3pCXcc.js";import{P as I}from"./PageTitle-B6CXaB8D.js";import{d as K}from"./documentCategoriesController-Dyoy1MPu.js";import{S as c}from"./sweetalert2.all-CB_IB5uz.js";import{T as b}from"./Table-BAHG1-BN.js";import{M as i}from"./Modal-DcT3UuQ-.js";import{B as E}from"./Badge-CZQ1jdNh.js";import"./useWindow-B4pHV13d.js";import"./AbstractModalHeader-CkypzX0C.js";import"./usePrevious-BQ-cea34.js";import"./hasClass-BQC5AZvh.js";import"./NoopTransition-wsq5_385.js";import"./DataKey-COGXBUcQ.js";const Z=()=>{var w;const o=r.useMemo(()=>new K,[]),[x,S]=r.useState([]),[B,f]=r.useState(!1),[A,d]=r.useState(!1),[j,g]=r.useState(null),[n,h]=r.useState({name:"",description:""}),[m,y]=r.useState({show:!1,list:[],category:null}),u=async()=>{try{f(!0);const t=await o.list(),s=Array.isArray(t)?t:(t==null?void 0:t.data)??(t==null?void 0:t.items)??[];S(s)}catch{c.fire({icon:"error",title:"Lỗi",text:"Không thể tải danh mục"})}finally{f(!1)}};r.useEffect(()=>{u()},[]);const T=()=>{g(null),h({name:"",description:""}),d(!0)},D=t=>{g(t.id),h({name:t.name||"",description:t.description||""}),d(!0)},L=async t=>{if(t.preventDefault(),!!n.name)try{j?await o.update(j,n):await o.create(n),await u(),c.fire({icon:"success",title:"Thành công",timer:1200,showConfirmButton:!1}),d(!1)}catch{c.fire({icon:"error",title:"Lỗi",text:"Không thể lưu"})}},k=async t=>{if((await c.fire({icon:"warning",title:"Xóa danh mục?",showCancelButton:!0})).isConfirmed)try{await o.remove(t),await u(),c.fire({icon:"success",title:"Đã xóa",timer:1e3,showConfirmButton:!1})}catch{c.fire({icon:"error",title:"Lỗi",text:"Không thể xóa"})}},M=async t=>{try{const s=await o.documentsByCategory(t.id),v=Array.isArray(s)?s:(s==null?void 0:s.data)??(s==null?void 0:s.items)??[];y({show:!0,list:v,category:t})}catch{c.fire({icon:"error",title:"Lỗi",text:"Không thể lấy tài liệu"})}};return e.jsxs(e.Fragment,{children:[e.jsx(H,{subName:"Pages",title:"Danh mục tài liệu"}),e.jsx(I,{title:"Danh mục tài liệu"}),e.jsx(C,{className:"mb-3",children:e.jsxs(C.Body,{children:[e.jsxs("div",{className:"d-flex flex-wrap justify-content-between align-items-center gap-2",children:[e.jsx("h4",{className:"card-title mb-0",children:"DANH SÁCH DANH MỤC"}),e.jsx(l,{size:"sm",variant:"primary",onClick:T,children:"Thêm danh mục"})]}),e.jsx("div",{className:"table-responsive mt-3",children:e.jsxs(b,{hover:!0,className:"table-striped align-middle",children:[e.jsx("thead",{className:"table-primary text-center",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Tên"}),e.jsx("th",{children:"Mô tả"}),e.jsx("th",{children:"Ngày tạo"}),e.jsx("th",{children:"Thao tác"})]})}),e.jsx("tbody",{children:B?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center p-5",children:"Đang tải dữ liệu..."})}):!Array.isArray(x)||x.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center p-5",children:"Không có danh mục."})}):x.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted",children:e.jsx("strong",{children:t.name})}),e.jsx("td",{className:"text-muted",children:t.description||"—"}),e.jsx("td",{className:"text-center",children:t.createdAt?new Date(t.createdAt).toLocaleDateString():"—"}),e.jsxs("td",{className:"text-center d-flex justify-content-center gap-2",children:[e.jsx(l,{size:"sm",variant:"info",title:"Xem tài liệu",onClick:()=>M(t),children:e.jsx(p,{icon:"mdi:eye-outline"})}),e.jsx(l,{size:"sm",variant:"primary",title:"Sửa",onClick:()=>D(t),children:e.jsx(p,{icon:"mdi:pencil-outline"})}),e.jsx(l,{size:"sm",variant:"danger",title:"Xóa",onClick:()=>k(t.id),children:e.jsx(p,{icon:"mdi:trash-can-outline"})})]})]},t.id))})]})})]})}),e.jsxs(i,{show:A,onHide:()=>d(!1),centered:!0,children:[e.jsx(i.Header,{closeButton:!0,children:e.jsx(i.Title,{children:j?"Chỉnh sửa danh mục":"Thêm danh mục"})}),e.jsxs(a,{onSubmit:L,children:[e.jsx(i.Body,{children:e.jsxs(P,{className:"g-3",children:[e.jsx(N,{md:12,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Tên"}),e.jsx(a.Control,{value:n.name,required:!0,onChange:t=>h({...n,name:t.target.value})})]})}),e.jsx(N,{md:12,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Mô tả"}),e.jsx(a.Control,{as:"textarea",rows:3,value:n.description,onChange:t=>h({...n,description:t.target.value})})]})})]})}),e.jsxs(i.Footer,{children:[e.jsx(l,{variant:"light",onClick:()=>d(!1),children:"Đóng"}),e.jsx(l,{type:"submit",variant:"primary",children:"Lưu"})]})]})]}),e.jsxs(i,{show:m.show,onHide:()=>y({show:!1,list:[],category:null}),centered:!0,children:[e.jsx(i.Header,{closeButton:!0,children:e.jsxs(i.Title,{children:["Tài liệu: ",(w=m.category)==null?void 0:w.name]})}),e.jsx(i.Body,{children:(m.list||[]).length===0?e.jsx("div",{className:"text-center text-muted",children:"Không có tài liệu."}):e.jsx("div",{className:"table-responsive",children:e.jsxs(b,{hover:!0,className:"align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Tiêu đề"}),e.jsx("th",{children:"Loại"}),e.jsx("th",{children:"Link"}),e.jsx("th",{children:"Trạng thái"})]})}),e.jsx("tbody",{children:m.list.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.title}),e.jsx("td",{children:e.jsx(E,{bg:"secondary",children:t.type})}),e.jsx("td",{children:e.jsx("a",{href:t.link,target:"_blank",rel:"noreferrer",children:"Mở"})}),e.jsx("td",{children:t.isActive?"Active":"Inactive"})]},t.id))})]})})})]})]})};export{Z as default};
