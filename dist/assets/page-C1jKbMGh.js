import{r as l,j as e,b as S,B as d,F as n,a as D,C as u,L as I,I as L,ax as $}from"./index-BmJdQGgB.js";import{P as K}from"./PageBreadcrumb-CQuiEbQ2.js";import{P as V}from"./PageTitle-DvSd9fON.js";import"./sweetalert2.all-BaGiBrXX.js";import{w as q}from"./index.module-DTJ1XoJG.js";import{T as G}from"./Table-C8TA4xmc.js";import{B as k}from"./Badge-D3WP5yAB.js";import{P as c}from"./Pagination-BmJ9MUyf.js";import{M as x}from"./Modal-CQ1QepL_.js";import"./Anchor-BiqR9obF.js";import"./useWindow-BVDv9fYI.js";import"./AbstractModalHeader-DLCW9Nx1.js";import"./usePrevious-Bo4w_kS6.js";import"./hasClass-DoaUOyhL.js";import"./NoopTransition-BBjJjQrR.js";import"./DataKey-COGXBUcQ.js";const C=new $,R=({swal:i})=>{const[p,A]=l.useState([]),[B,N]=l.useState(!1),[F,g]=l.useState(!1),[h,y]=l.useState({username:"",password:"",email:""}),[s,b]=l.useState({page:1,limit:10,role:"",email:"",phone:"",status:"",sort:"DESC"}),[w,P]=l.useState(0),j=async()=>{N(!0);try{const t=await C.getMemeber(s);A(t.data.data||[]),P(t.data.total||0)}catch(t){console.error(t),i.fire({title:"Lỗi",text:"Không thể tải danh sách thành viên",icon:"error"})}finally{N(!1)}};l.useEffect(()=>{j()},[s]);const v=t=>y({...h,[t.target.name]:t.target.value}),E=async t=>{t.preventDefault();try{(await C.createMemeber(h)).statusCode===200&&(i.fire({title:"Thành công!",text:"Tạo thành viên mới thành công.",icon:"success",timer:2e3}),y({username:"",password:"",email:""}),g(!1),j())}catch(a){console.error(a),i.fire({title:"Lỗi",text:"Tạo thành viên thất bại. Vui lòng thử lại.",icon:"error"})}},f=t=>{const{name:a,value:r}=t.target;b({...s,[a]:r,page:1})},M=()=>{b({page:1,limit:10,role:"",email:"",phone:"",status:"",sort:"DESC"})},m=t=>b({...s,page:t}),o=Math.ceil(w/s.limit),H=()=>{const a=[];for(let r=1;r<=o;r++)r===1||r===o||r>=s.page-2&&r<=s.page+2?a.push(r):a[a.length-1]!=="..."&&a.push("...");return a},U=async t=>{const a=t.status==="Active"?"Inactive":"Active";if((await i.fire({title:"Xác nhận",text:`Bạn có chắc chắn muốn đổi trạng thái ${t.username} sang ${a}?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Xác nhận",cancelButtonText:"Hủy",reverseButtons:!0})).isConfirmed)try{(await C.toggleMemberStatus(t.id)).statusCode===200?(i.fire("Thành công!",`Thành viên ${t.username} đã được chuyển sang ${a}.`,"success"),j()):i.fire("Lỗi!",`Không thể cập nhật trạng thái ${t.username}.`,"error")}catch(T){console.error(T),i.fire("Lỗi!","Có lỗi xảy ra. Vui lòng thử lại.","error")}};return e.jsxs(e.Fragment,{children:[e.jsx(S,{children:e.jsxs(S.Body,{children:[e.jsxs("div",{className:"d-flex flex-wrap justify-content-between align-items-center mb-4",children:[e.jsx("h4",{className:"card-title mb-0",children:"DANH SÁCH THÀNH VIÊN"}),e.jsx(d,{variant:"primary",onClick:()=>g(!0),children:"Thêm thành viên"})]}),e.jsx(n,{className:"mb-4 p-3 bg-light border rounded",children:e.jsxs(D,{className:"g-3 align-items-end",children:[e.jsxs(u,{lg:3,md:6,children:[e.jsx(n.Label,{children:"Email"}),e.jsx(n.Control,{placeholder:"Tìm theo Email...",name:"email",value:s.email,onChange:f})]}),e.jsxs(u,{lg:3,md:6,children:[e.jsx(n.Label,{children:"Vai trò"}),e.jsxs(n.Select,{name:"role",value:s.role,onChange:f,children:[e.jsx("option",{value:"",children:"Tất cả vai trò"}),e.jsx("option",{value:"ctv",children:"Cộng tác viên"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs(u,{lg:3,md:6,children:[e.jsx(n.Label,{children:"Trạng thái"}),e.jsxs(n.Select,{name:"status",value:s.status,onChange:f,children:[e.jsx("option",{value:"",children:"Tất cả trạng thái"}),e.jsx("option",{value:"Active",children:"Hoạt động"}),e.jsx("option",{value:"Inactive",children:"Bị khóa"})]})]}),e.jsxs(u,{lg:3,md:6,className:"d-flex gap-2",children:[e.jsx(d,{variant:"info",onClick:j,className:"w-100",children:"Tìm kiếm"}),e.jsx(d,{variant:"danger",onClick:M,className:"w-100",children:"Xóa lọc"})]})]})}),e.jsx("div",{className:"table-responsive",children:e.jsxs(G,{className:" align-middle text-center",children:[e.jsx("thead",{className:"table-primary",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Username"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Cấp bậc"}),e.jsx("th",{children:"Là Admin"}),e.jsx("th",{children:"Trạng thái"}),e.jsx("th",{children:"Ngày tạo"}),e.jsx("th",{children:"Thao tác"})]})}),e.jsx("tbody",{children:B?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center p-5",children:"Đang tải dữ liệu..."})}):p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center p-5",children:"Không tìm thấy thành viên nào."})}):p.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:t.username})}),e.jsx("td",{children:t.email}),e.jsx("td",{children:t.role}),e.jsx("td",{children:e.jsx(k,{bg:t.role==="admin"?"success-light":"danger-light",text:t.role==="admin"?"success":"danger",children:t.role==="admin"?"Có":"Không"})}),e.jsx("td",{children:e.jsx(k,{bg:t.status==="Active"?"success-light":"danger-light",text:t.status==="Active"?"success":"danger",children:t.status})}),e.jsx("td",{children:new Date(t.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"d-flex justify-content-center gap-2",children:[e.jsx(I,{to:`/page/members/${t.id}/?module=admin`,className:"btn btn-sm btn-primary",children:e.jsx(L,{icon:"mdi:pencil-outline"})}),e.jsx(d,{size:"sm",variant:t.status==="Active"?"danger":"success",onClick:()=>U(t),children:e.jsx(L,{icon:t.status==="Active"?"mdi:account-cancel-outline":"mdi:account-check-outline"})})]})]},t.id))})]})}),o>1&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("span",{children:["Hiển thị ",p.length," trên tổng số ",w," thành viên"]}),e.jsxs(c,{className:"justify-content-end mt-3 mb-0",children:[e.jsx(c.First,{disabled:s.page===1,onClick:()=>m(1)}),e.jsx(c.Prev,{disabled:s.page===1,onClick:()=>m(s.page-1)}),H().map((t,a)=>t==="..."?e.jsx(c.Ellipsis,{disabled:!0},a):e.jsx(c.Item,{active:s.page===t,onClick:()=>m(t),children:t},a)),e.jsx(c.Next,{disabled:s.page===o,onClick:()=>m(s.page+1)}),e.jsx(c.Last,{disabled:s.page===o,onClick:()=>m(o)})]})]})]})}),e.jsxs(x,{show:F,onHide:()=>g(!1),centered:!0,children:[e.jsx(x.Header,{closeButton:!0,children:e.jsx(x.Title,{children:"Thêm thành viên mới"})}),e.jsxs(n,{onSubmit:E,children:[e.jsxs(x.Body,{children:[e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Username"}),e.jsx(n.Control,{name:"username",value:h.username,onChange:v,placeholder:"Nhập username",required:!0,autoFocus:!0})]}),e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Password"}),e.jsx(n.Control,{type:"password",name:"password",value:h.password,onChange:v,placeholder:"Nhập password",required:!0})]}),e.jsxs(n.Group,{className:"mb-0",children:[e.jsx(n.Label,{children:"Email"}),e.jsx(n.Control,{type:"email",name:"email",value:h.email,onChange:v,placeholder:"Nhập email",required:!0})]})]}),e.jsxs(x.Footer,{children:[e.jsx(d,{variant:"light",onClick:()=>g(!1),children:"Đóng"}),e.jsx(d,{type:"submit",variant:"primary",children:"Lưu"})]})]})]})]})},X=q(R),ce=()=>e.jsxs(e.Fragment,{children:[e.jsx(K,{subName:"Pages",title:"Users"}),e.jsx(X,{}),e.jsx(V,{title:"Welcome"})]});export{ce as default};
