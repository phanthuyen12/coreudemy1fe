import{r as c,j as e,b as M,B as o,F as i,a as O,C as d,ay as P,I as D,az as Y}from"./index-UeTnRMFd.js";import{P as ee}from"./PageBreadcrumb-Dw3pCXcc.js";import{P as te}from"./PageTitle-B6CXaB8D.js";import{S}from"./sweetalert2.all-CB_IB5uz.js";import{w as ae}from"./index.module-DI6sRBOL.js";import{T as se}from"./Table-BAHG1-BN.js";import{B as K}from"./Badge-CZQ1jdNh.js";import{P as h}from"./Pagination-DWwWnq8n.js";import{M as l}from"./Modal-DcT3UuQ-.js";import"./Anchor-Cvy5GmK_.js";import"./useWindow-B4pHV13d.js";import"./AbstractModalHeader-CkypzX0C.js";import"./usePrevious-BQ-cea34.js";import"./hasClass-BQC5AZvh.js";import"./NoopTransition-wsq5_385.js";import"./DataKey-COGXBUcQ.js";const ie=()=>{const[p,E]=c.useState([]),f=new Y,[A,y]=c.useState(!1),[I,g]=c.useState(!1),[m,T]=c.useState(null),[s,x]=c.useState({name:"",code:"",description:"",image:"",active:1,isHeadOfice:0}),[H,N]=c.useState(null),[G,v]=c.useState(!1),[w,R]=c.useState(null),[n,k]=c.useState({page:1,limit:10,title:"",active:1}),[L,U]=c.useState(0),C=t=>{const a=t.target.name==="active"||t.target.name==="isHeadOfice"?Number(t.target.value):t.target.value;console.log(t.target.value),x({...s,[t.target.name]:a})},F=t=>{const a=t.target.name==="active"?t.target.value===""?"":Number(t.target.value):t.target.value;k({...n,[t.target.name]:a,page:1})},$=()=>k({page:1,limit:10,title:"",active:""}),z=t=>t.toUpperCase().replace(/[^A-Z0-9]/g,"").substring(0,8),b=async()=>{try{y(!0);const t=await f.getCourses({...n,active:n.active===""?"":n.active}),a=t.data.data.map(r=>({...r,active:r.active?1:0}));E(a||[]),U(t.data.total||0)}catch(t){console.error(t),S.fire({title:"Lỗi",text:"Không thể tải danh sách khóa học",icon:"error"})}finally{y(!1)}};c.useEffect(()=>{b()},[n.page,n.limit,n.title,n.active]),c.useEffect(()=>{s.name&&!s.code&&x(t=>({...t,code:z(s.name)}))},[s.name]);const u=Math.ceil(L/n.limit),V=()=>{const a=[];for(let r=1;r<=u;r++)r===1||r===u||r>=n.page-2&&r<=n.page+2?a.push(r):a[a.length-1]!=="..."&&a.push("...");return a},j=t=>k({...n,page:t}),q=()=>{T(null),x({name:"",code:"",description:"",image:"",active:1,isHeadOfice:0}),N(null),g(!0)},_=t=>{T(t.id),x({name:t.title,code:t.code,description:t.description,image:t.thumbnail||"",active:t.active,isHeadOfice:t.isHeadOfice!==void 0&&t.isHeadOfice?1:0}),N(null),g(!0)},W=async t=>{if(t.preventDefault(),!s.name||!s.code)return;const a=new FormData;a.append("title",s.name),a.append("description",s.description),a.append("code",s.code),a.append("active",s.active),a.append("isHeadOfice",s.isHeadOfice),H&&a.append("thumbnail",H);try{m?await f.updateCourse(m,a):await f.createCourses(a),await b(),S.fire({icon:"success",title:"Thành công",text:m?"Cập nhật khóa học thành công!":"Thêm khóa học thành công!",timer:2e3,showConfirmButton:!1})}catch(r){console.error(r),S.fire({icon:"error",title:"Lỗi",text:"Không thể lưu khóa học"})}g(!1)},X=async t=>{const a=p.find(r=>r.id===t);if(a)try{await f.updateCourse(t,{active:a.active===1?0:1}),await b(),swal.fire({icon:"success",title:"Cập nhật trạng thái!",text:`Khóa học "${a.title}" đã được ${a.active===1?"tạm dừng":"kích hoạt"}`,timer:1500,showConfirmButton:!1})}catch(r){console.error(r),swal.fire({icon:"error",title:"Lỗi",text:"Không thể cập nhật trạng thái"})}},Z=t=>{R(t),v(!0)},J=t=>{var B;const a=(B=t.target.files)==null?void 0:B[0];if(!a)return;N(a);const r=URL.createObjectURL(a);x(Q=>({...Q,image:r}))};return e.jsxs(e.Fragment,{children:[e.jsx(ee,{subName:"Pages",title:"Danh mục Khóa Học"}),e.jsx(te,{title:"Danh mục Khóa Học"}),e.jsx(M,{className:"mb-3",children:e.jsxs(M.Body,{children:[e.jsxs("div",{className:"d-flex flex-wrap justify-content-between align-items-center gap-2",children:[e.jsx("h4",{className:"card-title mb-0",children:"DANH SÁCH KHÓA HỌC"}),e.jsx(o,{size:"sm",variant:"primary",onClick:q,children:"Thêm khóa học"})]}),e.jsx(i,{className:"mt-3 p-3 bg-light border rounded",children:e.jsxs(O,{className:"g-3 align-items-end",children:[e.jsxs(d,{lg:4,md:6,children:[e.jsx(i.Label,{children:"Tìm kiếm"}),e.jsx(i.Control,{name:"title",value:n.title,onChange:F,placeholder:"Tên / Mã khóa"})]}),e.jsxs(d,{lg:3,md:6,children:[e.jsx(i.Label,{children:"Trạng thái"}),e.jsxs(i.Select,{name:"active",value:n.active,onChange:F,children:[e.jsx("option",{value:"",children:"Tất cả"}),e.jsx("option",{value:"1",children:"Hoạt động"}),e.jsx("option",{value:"0",children:"Tạm dừng"})]})]}),e.jsxs(d,{lg:2,md:6,className:"d-flex gap-2",children:[e.jsx(o,{variant:"info",className:"w-100",onClick:b,children:"Tìm kiếm"}),e.jsx(o,{variant:"danger",className:"w-100",onClick:$,children:"Xóa lọc"})]})]})}),e.jsx("div",{className:"table-responsive mt-3",children:e.jsxs(se,{hover:!0,className:"table-striped align-middle",children:[e.jsx("thead",{className:"table-primary text-center",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ảnh"}),e.jsx("th",{children:"Tên khóa học"}),e.jsx("th",{children:"Mã"}),e.jsx("th",{children:"Mô tả"}),e.jsx("th",{children:"Trạng thái"}),e.jsx("th",{children:"Ngày tạo"}),e.jsx("th",{children:"Thao tác"})]})}),e.jsx("tbody",{children:A?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center p-5",children:"Đang tải dữ liệu..."})}):p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center p-5",children:"Không tìm thấy khóa học nào."})}):p.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center",children:e.jsx("img",{src:`${P}/uploads/courses/${t.thumbnail}`||"/logo-sm.png",alt:t.title,width:46,height:46,className:"rounded object-fit-cover"})}),e.jsx("td",{className:"text-muted",children:e.jsx("strong",{children:t.title})}),e.jsx("td",{children:e.jsx(K,{bg:"primary",children:t.code})}),e.jsx("td",{className:"text-muted",children:t.description||"—"}),e.jsx("td",{className:"text-center",children:e.jsx(K,{bg:t.active===1?"success":"secondary",role:"button",onClick:()=>X(t.id),children:t.active===1?"Hoạt động":"Tạm dừng"})}),e.jsx("td",{className:"text-center",children:new Date(t.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"text-center d-flex justify-content-center gap-2",children:[e.jsx(o,{size:"sm",variant:"primary",title:"Sửa",onClick:()=>_(t),children:e.jsx(D,{icon:"mdi:pencil-outline"})}),e.jsx(o,{size:"sm",variant:"success",title:"Thêm videos",onClick:()=>Z(t),children:e.jsx(D,{icon:"mdi:video-plus-outline"})})]})]},t.id))})]})}),u>1&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("span",{children:["Hiển thị ",p.length," trên tổng số ",L," khóa học"]}),e.jsxs(h,{className:"justify-content-end mt-3 mb-0",children:[e.jsx(h.First,{disabled:n.page===1,onClick:()=>j(1)}),e.jsx(h.Prev,{disabled:n.page===1,onClick:()=>j(n.page-1)}),V().map((t,a)=>t==="..."?e.jsx(h.Ellipsis,{disabled:!0},a):e.jsx(h.Item,{active:n.page===Number(t),onClick:()=>j(Number(t)),children:t},a)),e.jsx(h.Next,{disabled:n.page===u,onClick:()=>j(n.page+1)}),e.jsx(h.Last,{disabled:n.page===u,onClick:()=>j(u)})]})]})]})}),e.jsxs(l,{show:I,onHide:()=>g(!1),centered:!0,children:[e.jsx(l.Header,{closeButton:!0,children:e.jsx(l.Title,{children:m?"Chỉnh sửa khóa học":"Thêm khóa học mới"})}),e.jsxs(i,{onSubmit:W,children:[e.jsx(l.Body,{children:e.jsxs(O,{className:"g-3",children:[e.jsx(d,{md:6,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Tên khóa học"}),e.jsx(i.Control,{name:"name",value:s.name,onChange:C,required:!0})]})}),e.jsx(d,{md:6,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Mã khóa (CODE)"}),e.jsx(i.Control,{name:"code",value:s.code,onChange:t=>x({...s,code:t.target.value.toUpperCase()}),required:!0})]})}),e.jsx(d,{md:12,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Mô tả ngắn"}),e.jsx(i.Control,{as:"textarea",rows:3,name:"description",value:s.description,onChange:C})]})}),e.jsx(d,{md:12,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Ảnh đại diện"}),e.jsx(i.Control,{type:"file",accept:"image/*",onChange:J}),m&&s.image&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.image.startsWith("http")?s.image:`${P}/uploads/courses/${s.image}`,alt:"preview",height:80,className:"rounded"})}),!m&&s.image&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.image,alt:"preview",height:80,className:"rounded"})})]})}),e.jsx(d,{md:6,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Trạng thái"}),e.jsxs(i.Select,{name:"active",value:s.active,onChange:C,children:[e.jsx("option",{value:"1",children:"Hoạt động"}),e.jsx("option",{value:"0",children:"Tạm dừng"})]})]})}),e.jsx(d,{md:6,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Loại khóa học"}),e.jsxs(i.Select,{name:"isHeadOfice",value:s.isHeadOfice,onChange:C,children:[e.jsx("option",{value:"0",children:"Khóa học phụ"}),e.jsx("option",{value:"1",children:"Khóa học chính"})]})]})})]})}),e.jsxs(l.Footer,{children:[e.jsx(o,{variant:"light",onClick:()=>g(!1),children:"Đóng"}),e.jsx(o,{type:"submit",variant:"primary",children:"Lưu"})]})]})]}),e.jsxs(l,{show:G,onHide:()=>v(!1),centered:!0,children:[e.jsx(l.Header,{closeButton:!0,children:e.jsxs(l.Title,{children:["Thêm videos cho: ",w==null?void 0:w.title]})}),e.jsx(l.Body,{children:e.jsx("div",{className:"alert alert-info mb-0",children:"Tính năng quản lý videos sẽ được tích hợp ở bước tiếp theo (upload/list/sort)."})}),e.jsxs(l.Footer,{children:[e.jsx(o,{variant:"light",onClick:()=>v(!1),children:"Đóng"}),e.jsx(o,{variant:"primary",onClick:()=>v(!1),children:"Lưu"})]})]})]})},be=ae(ie);export{be as default};
