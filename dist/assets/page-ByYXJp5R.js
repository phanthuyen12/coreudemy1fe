import{r as c,j as e,b as F,B as d,I,F as i,a as P,C as l,az as X}from"./index-UeTnRMFd.js";import{P as Z}from"./PageBreadcrumb-Dw3pCXcc.js";import{P as $}from"./PageTitle-B6CXaB8D.js";import{v as J}from"./videoCategoriesController-qMhot4Vn.js";import{S as T}from"./sweetalert2.all-CB_IB5uz.js";import{w as Q}from"./index.module-DI6sRBOL.js";import{T as W}from"./Table-BAHG1-BN.js";import{B as Y}from"./Badge-CZQ1jdNh.js";import{P as h}from"./Pagination-DWwWnq8n.js";import{M as p}from"./Modal-DcT3UuQ-.js";import"./Anchor-Cvy5GmK_.js";import"./useWindow-B4pHV13d.js";import"./AbstractModalHeader-CkypzX0C.js";import"./usePrevious-BQ-cea34.js";import"./hasClass-BQC5AZvh.js";import"./NoopTransition-wsq5_385.js";import"./DataKey-COGXBUcQ.js";const _=()=>{const[j,q]=c.useState([]),v=new J,[ee,k]=c.useState(!1),[N,H]=c.useState([]),[B,x]=c.useState(!1),[f,M]=c.useState(null),[r,C]=c.useState({name:"",code:"",description:"",active:1,courseId:""}),[n,y]=c.useState({page:1,limit:10,q:"",active:"",courseId:""}),[L,E]=c.useState(0),u=t=>{const a=t.target.name==="active"?Number(t.target.value):t.target.value;C({...r,[t.target.name]:a})},S=t=>{const a=t.target.name==="active"?t.target.value===""?"":Number(t.target.value):t.target.value;y({...n,[t.target.name]:a,page:1})},A=()=>y({page:1,limit:10,q:"",active:""}),K=t=>t.toUpperCase().replace(/[^A-Z0-9]/g,"").substring(0,8),b=async()=>{var t,a;try{k(!0);const s=await v.getCategories({page:n.page,limit:n.limit,q:n.q,active:n.active,courseId:n.courseId}),w=(((t=s==null?void 0:s.data)==null?void 0:t.data)||[]).map(D=>({...D,active:D.active?1:0}));q(w),E(((a=s==null?void 0:s.data)==null?void 0:a.total)||0)}finally{k(!1)}},z=async()=>{var o;const a=await new X().getCourses({page:1,limit:1e3,title:"",active:1}),s=(((o=a==null?void 0:a.data)==null?void 0:o.data)||[]).map(w=>({id:w.id,title:w.title}));H(s)};c.useEffect(()=>{b()},[n.page,n.limit,n.q,n.active,n.courseId]),c.useEffect(()=>{z()},[]),c.useEffect(()=>{r.name&&!r.code&&C(t=>({...t,code:K(r.name)}))},[r.name]);const m=Math.max(1,Math.ceil(L/n.limit)),G=()=>{const a=[];for(let s=1;s<=m;s++)s===1||s===m||s>=n.page-2&&s<=n.page+2?a.push(s):a[a.length-1]!=="..."&&a.push("...");return a},g=t=>y({...n,page:t}),V=()=>{M(null),C({name:"",code:"",description:"",active:1,courseId:""}),x(!0)},R=t=>{M(t.id),C({name:t.name||t.title,code:t.code,description:t.description,active:t.active,courseId:t.courseId||""}),x(!0)},O=async t=>{if(t.preventDefault(),!r.name||!r.code)return;const a=new FormData;a.append("title",r.name),a.append("code",r.code),a.append("description",r.description||""),a.append("active",String(r.active)),r.courseId&&a.append("courseId",String(r.courseId));try{let s;f?s=await v.updateCategory(f,a):s=await v.createCategory(a),s?(T.fire({icon:"success",title:"Thành công",text:f?"Cập nhật khóa học thành công!":"Thêm khóa học thành công!",timer:2e3,showConfirmButton:!1}),await b(),x(!1)):T.fire({icon:"error",title:"Lỗi",text:"Không thể lưu khóa học"})}catch(s){console.error(s),T.fire({icon:"error",title:"Lỗi",text:"Không thể lưu khóa học"})}},U=async t=>{const a=j.find(o=>o.id===t);if(!a)return;const s=new FormData;s.append("active",a.active===1?0:1),await v.updateCategory(t,s),await b()};return e.jsxs(e.Fragment,{children:[e.jsx(Z,{subName:"Pages",title:"Danh mục Video"}),e.jsx($,{title:"Danh mục Video"}),e.jsx(F,{className:"mb-3",children:e.jsxs(F.Body,{children:[e.jsxs("div",{className:"d-flex flex-wrap justify-content-between align-items-center gap-2",children:[e.jsx("h4",{className:"card-title mb-0",children:"DANH SÁCH DANH MỤC VIDEO"}),e.jsxs(d,{size:"sm",variant:"primary",onClick:V,children:[e.jsx(I,{icon:"mdi:folder-plus-outline",className:"me-1"})," Thêm danh mục"]})]}),e.jsx(i,{className:"mt-3 p-3 bg-light border rounded",children:e.jsxs(P,{className:"g-3 align-items-end",children:[e.jsxs(l,{lg:4,md:6,children:[e.jsx(i.Label,{children:"Tìm kiếm"}),e.jsx(i.Control,{name:"q",value:n.q,onChange:S,placeholder:"Tên / Mã"})]}),e.jsxs(l,{lg:3,md:6,children:[e.jsx(i.Label,{children:"Trạng thái"}),e.jsxs(i.Select,{name:"active",value:n.active,onChange:S,children:[e.jsx("option",{value:"",children:"Tất cả"}),e.jsx("option",{value:"1",children:"Hoạt động"}),e.jsx("option",{value:"0",children:"Tạm dừng"})]})]}),e.jsxs(l,{lg:3,md:6,children:[e.jsx(i.Label,{children:"Khóa học"}),e.jsxs(i.Select,{name:"courseId",value:n.courseId,onChange:S,children:[e.jsx("option",{value:"",children:"Tất cả"}),(N||[]).map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),e.jsxs(l,{lg:2,md:6,className:"d-flex gap-2",children:[e.jsx(d,{variant:"info",className:"w-100",onClick:b,children:"Tìm kiếm"}),e.jsx(d,{variant:"danger",className:"w-100",onClick:A,children:"Xóa lọc"})]})]})}),e.jsx("div",{className:"table-responsive mt-3",children:e.jsxs(W,{hover:!0,className:"mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Tên"}),e.jsx("th",{children:"Mã"}),e.jsx("th",{children:"Khóa học"}),e.jsx("th",{children:"Mô tả"}),e.jsx("th",{children:"Trạng thái"}),e.jsx("th",{children:"Ngày tạo"}),e.jsx("th",{style:{width:160},children:"Hành động"})]})}),e.jsxs("tbody",{children:[(j||[]).map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:(n.page-1)*n.limit+a+1}),e.jsx("td",{children:t.name||t.title}),e.jsx("td",{children:t.code}),e.jsx("td",{children:(()=>{const s=N.find(o=>String(o.id)===String(t.courseId));return s?s.title:"-"})()}),e.jsx("td",{children:t.description}),e.jsx("td",{children:e.jsx(Y,{bg:t.active===1?"success":"secondary",children:t.active===1?"Hoạt động":"Tạm dừng"})}),e.jsx("td",{children:t.createdAt?new Date(t.createdAt).toLocaleDateString():"-"}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(d,{size:"sm",variant:"secondary",onClick:()=>R(t),children:e.jsx(I,{icon:"mdi:pencil"})}),e.jsx(d,{size:"sm",variant:t.active===1?"warning":"success",onClick:()=>U(t.id),children:e.jsx(I,{icon:"mdi:power"})})]})})]},t.id)),(!j||j.length===0)&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-4 text-muted",children:"Không có dữ liệu"})})]})]})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsxs("div",{className:"text-muted",children:["Tổng: ",L]}),e.jsxs(h,{className:"mb-0",children:[e.jsx(h.First,{disabled:n.page===1,onClick:()=>g(1)}),e.jsx(h.Prev,{disabled:n.page===1,onClick:()=>g(Math.max(1,n.page-1))}),G().map((t,a)=>t==="..."?e.jsx(h.Ellipsis,{disabled:!0},`e-${a}`):e.jsx(h.Item,{active:t===n.page,onClick:()=>g(t),children:t},t)),e.jsx(h.Next,{disabled:n.page===m,onClick:()=>g(Math.min(m,n.page+1))}),e.jsx(h.Last,{disabled:n.page===m,onClick:()=>g(m)})]})]})]})}),e.jsxs(p,{show:B,onHide:()=>x(!1),centered:!0,children:[e.jsx(p.Header,{closeButton:!0,children:e.jsx(p.Title,{children:f?"Chỉnh sửa danh mục":"Thêm danh mục"})}),e.jsxs(i,{onSubmit:O,children:[e.jsx(p.Body,{children:e.jsxs(P,{className:"g-3",children:[e.jsx(l,{md:6,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Tên"}),e.jsx(i.Control,{name:"name",value:r.name,onChange:u,placeholder:"Nhập tên",required:!0})]})}),e.jsx(l,{md:6,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Mã"}),e.jsx(i.Control,{name:"code",value:r.code,onChange:u,placeholder:"Tự sinh từ tên",required:!0})]})}),e.jsx(l,{md:12,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Mô tả"}),e.jsx(i.Control,{as:"textarea",rows:3,name:"description",value:r.description,onChange:u,placeholder:"Mô tả ngắn"})]})}),e.jsx(l,{md:6,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Khóa học"}),e.jsxs(i.Select,{name:"courseId",value:r.courseId,onChange:u,required:!0,children:[e.jsx("option",{value:"",children:"-- Chọn khóa học --"}),(N||[]).map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]})}),e.jsx(l,{md:6,children:e.jsxs(i.Group,{children:[e.jsx(i.Label,{children:"Trạng thái"}),e.jsxs(i.Select,{name:"active",value:r.active,onChange:u,children:[e.jsx("option",{value:"1",children:"Hoạt động"}),e.jsx("option",{value:"0",children:"Tạm dừng"})]})]})})]})}),e.jsxs(p.Footer,{children:[e.jsx(d,{variant:"secondary",onClick:()=>x(!1),children:"Hủy"}),e.jsx(d,{variant:"primary",type:"submit",children:"Lưu"})]})]})]})]})},ve=Q(_);export{ve as default};
